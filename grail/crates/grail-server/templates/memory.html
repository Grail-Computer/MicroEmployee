{% extends "layout.html" %}
{% block title %}Grail | Memory{% endblock %}
{% block content %}
  <h2>Memory</h2>
  <p class="section-desc">
    Sessions are stored per conversation. Clearing a session resets its rolling memory summary and Codex thread mapping.
  </p>
  <table>
    <thead>
      <tr>
        <th>Conversation</th>
        <th>Codex Thread</th>
        <th>Memory Summary</th>
        <th>Last Used</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for s in sessions %}
        <tr>
          <td style="max-width: 300px; font-family: var(--font-mono); font-size: 12px;">{{ s.conversation_key }}</td>
          <td style="max-width: 200px; font-family: var(--font-mono); font-size: 12px;" class="text-muted">{{ s.codex_thread_id }}</td>
          <td style="max-width: 360px;" class="text-muted">{{ s.memory_summary }}</td>
          <td class="text-muted" style="white-space: nowrap;">{{ s.last_used_at }}</td>
          <td>
            <form method="post" action="/admin/memory/clear">
              <input type="hidden" name="conversation_key" value="{{ s.conversation_key }}" />
              <button type="submit" class="btn-danger btn-sm">Clear</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
