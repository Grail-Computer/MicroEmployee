{% extends "layout.html" %}
{% block title %}Grail | Queue{% endblock %}
{% block content %}
  <h2 style="margin:0 0 10px 0; font-weight:700;">Queue</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Status</th>
        <th>Channel</th>
        <th>Thread TS</th>
        <th>Prompt</th>
        <th>Result / Error</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for t in tasks %}
        <tr>
          <td>{{ t.id }}</td>
          <td>{{ t.status }}</td>
          <td>{{ t.channel_id }}</td>
          <td>{{ t.thread_ts }}</td>
          <td style="max-width: 420px; color: var(--muted);">{{ t.prompt_text }}</td>
          <td style="max-width: 420px; color: var(--muted);">
            {% if t.result_text != "" %}
              {{ t.result_text }}
            {% endif %}
            {% if t.error_text != "" %}
              <span style="color: rgba(255,107,107,0.95);">{{ t.error_text }}</span>
            {% endif %}
          </td>
          <td style="color: var(--muted);">{{ t.created_at }}</td>
          <td>
            {% if t.status == "queued" %}
              <form method="post" action="/admin/tasks/{{ t.id }}/cancel">
                <button type="submit" style="margin-top:0; padding:6px 10px; font-size:12px; border-color: rgba(255,107,107,0.35); background: rgba(255,107,107,0.10); color: rgba(255,107,107,0.95);">
                  Cancel
                </button>
              </form>
            {% endif %}

            {% if t.status == "failed" || t.status == "cancelled" %}
              <form method="post" action="/admin/tasks/{{ t.id }}/retry">
                <button type="submit" style="margin-top:8px; padding:6px 10px; font-size:12px;">
                  Retry
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
